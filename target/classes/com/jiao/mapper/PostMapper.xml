<?xml version="1.0" encoding="UTF-8"?>    
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"    
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="com.jiao.dao.PostDao">
    <resultMap id="PostResultMap" type="com.jiao.domain.Post">
            <id     column="pid"        property="_pid"        jdbcType="INTEGER"/> 
			<result column="uid"        property="_userid"     jdbcType="INTEGER" />  
        	<result column="cretime"    property="_cretime"    jdbcType="TIMESTAMP" />  
        	<result column="contentdep" property="_contentdep" jdbcType="BLOB"  typeHandler="org.apache.ibatis.type.BlobTypeHandler"/> 
        	<result column="content"    property="_content"    jdbcType="BLOB"  typeHandler="org.apache.ibatis.type.BlobTypeHandler"/> 
        	<result column="title"      property="_title"      jdbcType="VARCHAR" javaType="String"/> 
        	<association property="user" javaType="com.jiao.domain.User">
        		<id     column="userid" 	property="userId" 			jdbcType="INTEGER" />  
        		<result column="username" 	property="userName" 		jdbcType="VARCHAR" />  
        		<result column="pwd" 		property="userPassword" 	jdbcType="VARCHAR" />  
        		<result column="useremail" 	property="userEmail" 		jdbcType="VARCHAR" /> 
        		<result column="regtime" 	property="userRegtimestamp" jdbcType="TIMESTAMP" /> 
        	</association>
        	<collection property="replys" ofType="com.jiao.domain.Reply" javaType="ArrayList">
        		<id     column="rid"        property="_rid"         jdbcType="INTEGER"/> 
				<result column="pid"        property="_pid"     	jdbcType="INTEGER" />  
        		<result column="uid"    	property="_uid"    		jdbcType="INTEGER" />  
        		<result column="cretime" 	property="_cretime" 	jdbcType="TIMESTAMP"/> 
        		<result column="content"    property="_content"     jdbcType="BLOB"  typeHandler="org.apache.ibatis.type.BlobTypeHandler"/>
        	</collection>
    </resultMap>  
    
    <!-- 单个帖子 -->
    <select id="selectPostByid" resultMap="PostResultMap">  
        SELECT * FROM post WHERE uid=#{id}
    </select>

    <!-- 查询前十个帖子 --> 
    <select id="selectFirstTenPost" resultMap="PostResultMap">  
        SELECT * FROM post LIMIT 10
    </select>

    <!-- 根据title联合查询 --> 
    <select id="selectPostBytitle" resultMap="PostResultMap">  
        SELECT * FROM post p LEFT JOIN reply r ON (p.pid=r.pid)
        WHERE p.title=#{ttl}
    </select>
        
    <select id="selectPostBypid" resultMap="PostResultMap">
    	SELECT * FROM post p INNER JOIN reply r ON p.pid=r.pid
    	WHERE p.pid=#{id}
    </select>
    
        <insert id="addNewPost">
    	INSERT INTO post(uid,contentdep,content,title) 
    		values(#{userid,jdbcType=INTEGER},#{contdep,jdbcType=BLOB},
    		#{cont,jdbcType=BLOB},#{ttl,jdbcType=VARCHAR})
    </insert>
</mapper>